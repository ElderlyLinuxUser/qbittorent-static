name: Build qBittorrent static ( libtorrent part )

on:
  push:
    branches:
      - boost and libtorrent
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install build dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential git cmake wget


    - name: Build and install Boost
      run: |
        wget -q https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.gz
        tar -xzf boost_1_81_0.tar.gz
        cd boost_1_81_0
        ./bootstrap.sh
        ./b2  clean
        sudo ./b2  link=static runtime-link=static install --prefix=/usr/local/boost

    - name: Build and install libtorrent
      run: |
        git clone --recursive https://github.com/arvidn/libtorrent.git
        cd libtorrent
        ./configure --enable-static --disable-shared --with-boost=/usr/local/boost
        make -j$(nproc)
        sudo make install

